<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div class="container">
        <form onsubmit="handleSubmit(event)">
        <label for="expAmount">Expense Amount</label>
        <input type="number" id="expAmount" name="expAmount">
         <label for="expDesc">Expense Description</label>
        <input type="text" id="expDesc" name="expDesc">
         <label for="expcategory">Choose a Category</label>
         <select name="expcategory" id="expcategory">
            <option value="null"></option>
            <option value="Fuel">Fuel</option>
            <option value="Food">Food</option>
            <option value="Electricity">Electricity</option>
            <option value="Movie">Movie</option>
         </select>
         <button type="submit" id="sBtn">Add Expense</button>
        </form>
    </div>
    <div id="expenses">
        <ul id="expenseList">

        </ul>

    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.8/axios.min.js" integrity="sha512-PJa3oQSLWRB7wHZ7GQ/g+qyv6r4mbuhmiDb8BjSFZ8NZ2a42oTtAq5n0ucWAwcQDlikAtkub+tPVCw4np27WCg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        function handleSubmit(event){
         
            event.preventDefault();
            const token=localStorage.getItem('token');
            const amount=event.target.expAmount.value;
            const description=event.target.expDesc.value;
            const expensecat=event.target.expcategory.value;
            const obj={
                Amount:amount,
                Description:description,
                ExpenseCategory:expensecat

            }
            console.log(obj);
        axios.post('http://localhost:3000/expense/add-expense',obj,
        {headers:{
                "Authorization":token
            }
        }
    )
            .then(response=>{
                console.log(response.data.newExpenseDetails);
                showExpenseDetails(response.data.newExpenseDetails);
         }).catch(err=>{
                console.log('axios error');
                console.log(err)
            });
            document.getElementById('expAmount').value="";
            document.getElementById('expDesc').value="";
            document.getElementById('expcategory').value="";
        }
    
        function showExpenseDetails(expense){
            const expenseul=document.getElementById('expenseList');
            const newLi=document.createElement('li');
            newLi.textContent=`${expense.Amount}- ${expense.Description}- ${expense.Category}`;
            const dltbtn=document.createElement('button');
            dltbtn.id="delete";
            dltbtn.textContent="Delete Expense";
            
            dltbtn.addEventListener('click',(eventclick)=>{
                removeExpense(eventclick,expense)
            }); 
           
            newLi.appendChild(dltbtn);   
            expenseul.appendChild(newLi); 
    }
    window.addEventListener('DOMContentLoaded',()=>{
        const token=localStorage.getItem('token');
        axios.get("http://localhost:3000/expense/get-expense",{
            headers:{
                "Authorization":token
            }
        })
        .then(response=>{
            for(var i=0;i<response.data.allExpense.length;i++){
                showExpenseDetails(response.data.allExpense[i]);
            }

        }).catch(err=>console.log(err));
    });
    function removeExpense(eventclick,expense){
        console.log(expense);
        const token=localStorage.getItem('token');
        axios.delete(`http://localhost:3000/expense/delete-expenses/${expense.id}`, {headers:{
                "Authorization":token
        },data:expense
            })
        .then(response=>{
            console.log(response);
            const expenseul=document.getElementById('expenseList');
            expenseul.removeChild(eventclick.target.parentElement);
            
        }).catch(err=>console.log(err));
    }

        
    </script>
</body>
</html>